import Head from "next/head";
import { fr } from "@codegouvfr/react-dsfr";
import {
  baseFormSchema,
  useDataContractForm,
} from "~/utils/forms/data-contract/schema";
import {
  BaseDataContractForm,
  dataContractFormDefaultValues,
} from "~/utils/forms/data-contract/form";
import { tss } from "tss-react";
import { api } from "~/utils/api";

export default function Home() {
  const { mutateAsync: createRequest } = api.request.create.useMutation();

  const { classes } = useStyles();

  const form = useDataContractForm({
    defaultValues: dataContractFormDefaultValues,
    validators: {
      onSubmit: baseFormSchema,
    },
    onSubmit: async (values) => {
      console.log("Form submitted:", values.value);
      const newRequest = await createRequest({
        data: values.value,
      });
      console.log("New request created:", newRequest);
    },
  });

  return (
    <>
      <Head>
        <title>DCF - Accueil</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <div className={fr.cx("fr-mt-4w", "fr-mb-8w")}>
          <h1>Formulaire de demande</h1>
          <p className={fr.cx("fr-text--lg")}>
            Veuillez remplir le formulaire ci-dessous pour soumettre votre
            demande.
          </p>
          <form.AppForm>
            <form
              onSubmit={(e) => {
                e.preventDefault();
                form.handleSubmit();
              }}
              className={classes.formWrapper}
            >
              <BaseDataContractForm
                formId="base-data-contract-form"
                disabled={false}
                form={form}
              />
            </form>
          </form.AppForm>
        </div>
      </main>
    </>
  );
}

const useStyles = tss.withName(Home.name).create(() => ({
  formWrapper: {
    display: "flex",
    flexDirection: "column",
    gap: fr.spacing("3w"),
  },
}));
